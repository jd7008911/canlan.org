# Auth API examples for REST Client / HTTP client

@base = http://localhost:8080
@wallet = 0x1000000000000000000000000000000000000100
@signature = 0x6b1f2d3a4b5c6d7e8f9a0b1c2d3e4f5061728394a5b6c7d8e9f0a1b2c3d4e5f601
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NzEwNTYzNjQsImlhdCI6MTc3MDk2OTk2NCwidXNlcl9pZCI6ImFkOTZmNmY1LWY3YTUtNDRiMS1iNDE3LWQ5MDFkZDA4MGEyNCIsIndhbGxldCI6IjB4OGZkMzc5MjQ2ODM0ZWFjNzRCODQxOUZmZEEyMDJDRjgwNTFGN0EwMyJ9.lkmXgxWFxxz9a6Ycbb-9YPdUiezw4gKPJ_-U96SDar0
@privkey = 0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
@derived_wallet = 0x8fd379246834eac74B8419FfdA202CF8051F7A03

### REST Client Requests

### Request Nonce (REST Client)
POST {{base}}/api/v1/auth/nonce
Content-Type: application/json

{
  "wallet": "{{derived_wallet}}"
}

### Login (REST Client)
POST {{base}}/api/v1/auth/login
Content-Type: application/json

{
  "wallet": "{{derived_wallet}}",
  "signature": "{{signature}}",
  "referral": ""
}

### Get Current User (REST Client)
GET {{base}}/api/v1/auth/me
Authorization: Bearer {{token}}


### Dev-tools one-liner
# Request a nonce, sign with `dev-tools/sign.js`, login, and call /me
nonce=$(curl -s -X POST {{base}}/api/v1/auth/nonce -H "Content-Type: application/json" -d '{"wallet":"'"'{{derived_wallet}}'"'"}' | jq -r '.nonce')
sig=$(node dev-tools/sign.js {{privkey}} "$nonce")
token=$(curl -s -X POST {{base}}/api/v1/auth/login -H "Content-Type: application/json" -d '{"wallet":"'"'{{derived_wallet}}'"'","signature":"'$sig'","referral":""}' | jq -r '.token')
echo "token=$token"
curl -s {{base}}/api/v1/auth/me -H "Authorization: Bearer $token"

